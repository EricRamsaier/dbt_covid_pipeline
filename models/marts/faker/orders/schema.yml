version: 2

models:
  - name: dim_faker_currency
    description: >
      Dimension table for currencies, enriched with surrogate keys.
    columns:
      - name: currency_sk
        description: Surrogate key generated from currency_id.
        tests:
          - not_null
          - unique
          - no_fallback:
              severity: warn
      - name: currency_id
        description: Natural key from the source system.
        tests:
          - not_null
          - unique
      - name: currency_code
        description: ISO code or shorthand for the currency.
        tests:
          - not_null
      - name: currency_name
        description: Full name of the currency.
        tests:
          - not_null
      - name: currency_symbol
        description: Currency symbol (e.g., $, €, £).
        tests:
          - not_null

  - name: dim_faker_customer
    description: >
      Dimension table for customers, with enriched attributes and surrogate keys.
    columns:
      - name: customer_sk
        description: Surrogate key generated from customer_id.
        tests:
          - not_null
          - unique
          - no_fallback:
              severity: warn
      - name: customer_id
        description: Natural customer identifier from the source.
        tests:
          - not_null
          - unique
      - name: customer_name
        description: Full name of the customer.
        tests:
          - not_null
      - name: customer_email
        description: Email address of the customer.
        tests:
          - not_null
      - name: customer_country
        description: Country associated with the customer.
      - name: is_valid_email
        description: Boolean flag indicating if the email is valid.
      - name: email_domain
        description: Extracted domain from the customer_email.

  - name: dim_faker_product
    description: >
      Dimension table for products, with standardized category info and surrogate keys.
    columns:
      - name: product_sk
        description: Surrogate key generated from product_id.
        tests:
          - not_null
          - unique
          - no_fallback:
              severity: warn
      - name: product_id
        description: Natural product identifier from the source.
        tests:
          - not_null
          - unique
      - name: product_name
        description: Descriptive name of the product.
        tests:
          - not_null
      - name: product_category
        description: Original category as provided in the source data.
      - name: product_category_standardized
        description: Cleaned or standardized version of product category.
        tests:
          - not_null

  - name: fct_faker_order_items
    description: >
      Fact table for order items.
      One row per order item with surrogate keys for orders and products.
    columns:
      - name: order_item_sk
        description: Surrogate key generated from order_id and product_id.
        tests:
          - not_null
      - name: order_id
        description: Natural key for the order.
        tests:
          - not_null
      - name: order_sk
        description: Surrogate key for order. '-1' indicates unmatched.
        tests:
          - not_null
          - no_fallback:
              severity: warn
          - relationships:
              to: ref('fct_faker_orders')
              field: order_sk
      - name: product_id
        description: Natural key for the product.
        tests:
          - not_null
      - name: product_sk
        description: Surrogate key for product. '-1' indicates unmatched.
        tests:
          - not_null
          - no_fallback:
              severity: warn
          - relationships:
              to: ref('dim_faker_product')
              field: product_sk
      - name: order_sales_qty
        description: Quantity of items sold in this order item.
        tests:
          - not_null
      - name: order_sales_unit_price
        description: Unit sale price for this item.
        tests:
          - not_null
      - name: order_sales_line_total
        description: Total sales amount for this order item (qty × unit price).
        tests:
          - not_null
      - name: order_ts
        description: Timestamp when the order item was placed.
        tests:
          - not_null
      - name: order_dt
        description: Date extracted from order_ts.
        tests:
          - not_null


  - name: fct_faker_orders
    description: >
      Fact table for customer orders.
      One row per order, enriched with surrogate keys, totals, and audit metadata.
    columns:
      - name: order_sk
        description: Surrogate key for the order. Generated from natural key.
        tests:
          - not_null
          - unique
      - name: order_id
        description: Natural key from the source system.
        tests:
          - not_null
          - unique
      - name: customer_sk
        description: Surrogate key referencing the customer dimension. '-1' if unmatched.
        tests:
          - not_null
          - no_fallback:
              severity: warn
          - relationships:
              to: ref('dim_faker_customer')
              field: customer_sk
      - name: currency_sk
        description: Surrogate key referencing the currency dimension. '-1' if unmatched.
        tests:
          - not_null
          - no_fallback:
              severity: warn
          - relationships:
              to: ref('dim_faker_currency')
              field: currency_sk
      - name: order_ts
        description: Timestamp when the order was placed.
        tests:
          - not_null
      - name: order_dt
        description: Date (derived from order_ts).
        tests:
          - not_null
      - name: total_order_amount
        description: Sum of all line totals for this order.
        tests:
          - not_null
      - name: total_order_qty
        description: Sum of quantities for all items in this order.
        tests: 
          - not_null
      - name: order_status
        description: Status derived from order recency (e.g., recent, old).
